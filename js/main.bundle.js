(()=>{var e={533:()=>{const e=document.querySelector(".img-upload__effects"),t=document.querySelector(".img-upload__effect-level"),r=document.querySelector(".effect-level__slider"),n=document.querySelector(".img-upload__preview > img"),o=document.querySelector(".effect-level__value");t.classList.add("visually-hidden");let c="";const s={none:()=>(t.classList.add("visually-hidden"),"none"),chrome:()=>(t.classList.remove("visually-hidden"),`grayscale(${.01*parseInt(o.value,10)})`),sepia:()=>(t.classList.remove("visually-hidden"),`sepia(${.01*parseInt(o.value,10)})`),marvin:()=>(t.classList.remove("visually-hidden"),`invert(${Math.floor(o.value)}%)`),phobos:()=>(t.classList.remove("visually-hidden"),`blur(${3*parseInt(o.value,10)*.01}px)`),heat:()=>(t.classList.remove("visually-hidden"),`brightness(${3*parseInt(o.value,10)*.01})`)};e.addEventListener("click",(e=>{if(e.target.classList.contains("effects__preview")){""!==c&&n.classList.remove(c),r.noUiSlider.set(100);let t=e.target.classList[1];c=t,n.classList.add(t),n.style.filter=s[t.replace("effects__preview--","")]()}})),noUiSlider.create(r,{range:{min:0,max:100},start:100,connect:"lower"}),r.noUiSlider.on("change",(()=>{o.value=Math.round(r.noUiSlider.get()),n.style.filter=s[c.replace("effects__preview--","")]()}))},248:()=>{const e=["jpg","jpeg","img","png"],t=document.querySelector("#upload-file"),r=document.querySelector(".img-upload__preview").querySelector("img"),n=document.querySelectorAll(".effects__preview");t.addEventListener("change",(()=>{const o=t.files[0],c=o.name.toLowerCase();if(e.some((e=>c.endsWith(e)))){const e=new FileReader;e.addEventListener("load",(()=>{r.src=e.result,r.width=600,r.height=600,n.forEach((t=>{t.style.backgroundImage=`url(${e.result})`}))})),e.readAsDataURL(o)}}))}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,r),c.exports}(()=>{"use strict";const e=e=>"Esc"===e.key||"Escape"===e.key,t=document.querySelector(".big-picture"),n=document.querySelector("body"),o=t.querySelector(".big-picture__cancel"),c=document.querySelector(".social__comment"),s=document.querySelector(".social__comments");let l=[];const i=t.querySelector(".social__comment-count"),a=t.querySelector(".comments-loader");let d=5;const u=()=>{t.classList.add("hidden"),n.classList.remove("modal-open"),o.removeEventListener("click",u),s.innerHTML="",document.removeEventListener("keydown",v),d=5,l=[]},m=e=>{d=e.length<5?e.length:d,l=e.slice(0,d),s.innerHTML="",i.textContent=`${l.length} из ${e.length} комментариев`;let t=document.createDocumentFragment();l.forEach((e=>{t.appendChild((e=>{const t=c.cloneNode(!0);return t.querySelector(".social__picture").src=e.avatar,t.querySelector(".social__picture").alt=e.name,t.querySelector(".social__text").textContent=e.message,t})(e))})),s.appendChild(t),e.length>5&&l.length<e.length?(a.classList.remove("hidden"),a.addEventListener("click",(()=>{m(e)}),{once:!0})):a.classList.add("hidden"),d+=5},v=t=>{e(t)&&u()},y=document.querySelector("#picture").content.querySelector(".picture"),p=document.querySelector(".pictures"),_=e=>{let r=document.createDocumentFragment();e.forEach((e=>{r.appendChild((e=>{const r=y.cloneNode(!0);return r.querySelector(".picture__img").src=e.url,r.querySelector(".picture__likes").textContent=e.likes,r.querySelector(".picture__comments").textContent=e.comments.length,r.addEventListener("click",(r=>{r.preventDefault(),(e=>{d=5,l=[],n.classList.add("modal-open"),t.querySelector(".big-picture__img > img").src=e.url,t.querySelector(".likes-count").textContent=e.likes,t.querySelector(".social__caption").textContent=e.description,o.addEventListener("click",u),t.classList.remove("hidden"),document.addEventListener("keydown",v),m(e.comments.slice())})(e)})),r})(e))})),p.appendChild(r)},g={GET:"https://23.javascript.pages.academy/kekstagram/data",POST:"https://23.javascript.pages.academy/kekstagram"},h=(e,t,r,n)=>{fetch(g[r],{method:r,body:n}).then((e=>e.json())).then((t=>{e(t)})).catch((()=>{t()}))},L=document.querySelector("main"),S=document.querySelector("#error").content,f=document.createDocumentFragment(),q=document.querySelector("#success").content,E=document.createDocumentFragment(),k=t=>{e(t)&&C()},C=e=>{document.querySelector(e).remove(),document.removeEventListener("keydown",k)},w=(e,t)=>{const r=S.cloneNode(!0);r.querySelector(".error__title").textContent=e,r.querySelector(".error__button").textContent=t;const n=r.querySelector(".error__button");r.querySelector(".error").addEventListener("click",(e=>{e.target.classList.contains("error__inner")||C(".error")})),n.addEventListener("click",(()=>{C(".error")})),document.addEventListener("keydown",k),f.appendChild(r),L.appendChild(f)},x=document.querySelector("body"),b=document.querySelector(".img-upload__overlay"),D=document.querySelector("#upload-file"),V=document.querySelector("#upload-cancel");D.addEventListener("change",(()=>{j(),b.classList.remove("hidden"),x.classList.add("modal-open")}));const T=()=>{b.classList.add("hidden"),x.classList.remove("modal-open"),D.value=""};V.addEventListener("click",(function(){T()})),document.addEventListener("keydown",(t=>{e(t)&&T()}));const $=b.querySelector(".scale__control--bigger"),I=b.querySelector(".scale__control--smaller"),F=b.querySelector(".scale__control--value"),M=b.querySelector(".img-upload__preview > img"),j=()=>{M.style="transform: scale(1.00)",F.value="100%"};$.addEventListener("click",(()=>{let e=parseInt(F.value,10)+25;e>=100&&(e=100),F.value=e+"%",e/=100,M.style.transform="scale("+e+")"})),I.addEventListener("click",(()=>{let e=parseInt(F.value,10)-25;e<=25&&(e=25),F.value=e+"%",e/=100,M.style.transform="scale("+e+")"}));const U=document.querySelector(".img-upload__form"),N=()=>{(e=>{const t=q.cloneNode(!0);t.querySelector(".success__title").textContent="Удачно!";const r=t.querySelector(".success__button");t.querySelector(".success").addEventListener("click",(e=>{e.target.classList.contains("success__inner")||C(".success")})),r.addEventListener("click",(()=>{C(".success")})),document.addEventListener("keydown",k),E.appendChild(t),L.appendChild(E)})(),T(),U.reset()},O=()=>{w("ЧТо-то пошло не так","Загрузить другой файл")};U.addEventListener("submit",(e=>{e.preventDefault(),h(N,O,"POST",new FormData(e.target))})),r(533);let A=document.querySelector(".text__hashtags"),P=document.querySelector(".text__description");P.addEventListener("input",(()=>{P.setCustomValidity(""),P.value.length>140&&P.setCustomValidity("Максимум 140 символов")})),A.addEventListener("input",(()=>{A.setCustomValidity("");let e=A.value.toLowerCase().trim();if(!e)return;let t=e.split(/\s+/);0!==t.length&&(t.some((e=>"#"!==e[0]))&&A.setCustomValidity("Хэш-тег начинается с символа # (решётка)"),t.some((e=>"#"===e))&&A.setCustomValidity("Хэш-тег не может состоять только из решетки"),t.some((e=>e.indexOf("#",1)>=1))&&A.setCustomValidity("Хэш-теги разделяются пробелами"),t.some(((e,t,r)=>r.indexOf(e,t+1)>=t+1))&&A.setCustomValidity("Хэш-теги не должны повторяться"),t.some((e=>e.length>20))&&A.setCustomValidity("Максимальная длина хэш-тега 20 символов, включая решетку"),t.length>5&&A.setCustomValidity("Максимум 5 хэш-тегов"))}));const G=t=>{e(t)&&(t.preventDefault(),t.stopPropagation())};A.addEventListener("keydown",G),P.addEventListener("keydown",G),r(248);const H=document.querySelector(".img-filters");let R=[];const W={"filter-default":()=>{_(R.slice(0,19))},"filter-random":()=>{_((e=>{let t,r;for(let n=e.length-1;n>0;n--)t=Math.floor(Math.random()*(n+1)),r=e[t],e[t]=e[n],e[n]=r;return e})(R.slice()).slice(0,5))},"filter-discussed":()=>{_(R.slice().sort(((e,t)=>t.comments.length-e.comments.length)))}};h((e=>{H.classList.remove("img-filters--inactive"),R=e.slice(),_(R.slice(0,19))}),(()=>{w("Ошибка загрузки, попробуйте еще раз","Закрыть")}),"GET");const z=(e=>{let t=null;return(...e)=>{t&&window.clearTimeout(t),t=window.setTimeout((()=>{(e=>{e.target.classList.contains("img-filters__button")&&(document.querySelector(".img-filters__button--active").classList.remove("img-filters__button--active"),(()=>{const e=document.querySelectorAll(".picture");e&&e.forEach((e=>{e.remove()}))})(),e.target.classList.add("img-filters__button--active"),W[e.target.id]())})(...e)}),500)}})();H.addEventListener("click",z)})()})();
//# sourceMappingURL=main.bundle.js.map